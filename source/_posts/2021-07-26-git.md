---
layout: post
title:  "Git"
date:   2021-07-26 00:0054 +0900
categories: Git
---

### git revert, reset, rebase, splash, cherry-pick 등 알아보기

- revert 하고 난 뒤에 다시 해당 브랜치를 머지하려면. re-revert를 해야함.

- 리비전 : 이전 커밋 상태부터 현재 상태까지의 변경 이력이 기록

- 커밋은 이렇게 이력을 남기는 중요한 작업이기 때문에 커밋 버튼을 누를땐 커밋 메시지를 필수로 입력해야 합니다. 메시지가 없으면 커밋이 실행되지 않습니다.

- Git 에서는 우리가 흔히 말하는 폴더를 '작업 트리'(Work Tree)라고 부릅니다.

- 커밋을 실행하기 전의 저장소와 작업 트리 사이에 존재하는 공간을 '인덱스'라고 합니다.

```
로컬 저장소(work tree) - 인덱스 -  원격 저장소
```

- 예를 들어서 커밋이란걸 해도 푸쉬를 하지않으면 원격 저장소는 알지 못한다.
하지만 커밋을 하면 이 커밋 내역을 revert 등의 원하는 작업이 가능하다. 이를 위해서는 이 커밋 내용을 어딘가에 저장을 해야하는데.
이를 인덱스라고 부른다. 이게 로컬공간이지. 원격공간은 아닐듯 (일단은 가상의 개념)

- 통합 브랜치란 언제든지 배포할 수 있는 버전을 만들 수 있어야 하는 브랜치 입니다. / 일반적으로 저장소를 처음 만들었을 때에 생기는 'master' 브랜치를 통합 브랜치로 사용합니다.

- 토픽 브랜치란, 기능 추가나 버그 수정과 같은 단위 작업을 위한 브랜치 입니다. 여러 개의 작업을 동시에 진행할 때에는, 그 수만큼 토픽 브랜치를 생성할 수 있습니다. / '피처 브랜치(Feature branch)' 라고 부르기도 합니다.

- 'HEAD' 란 현재 사용 중인 브랜치의 선두 부분을 나타내는 이름입니다. 기본적으로는 'master'의 선두 부분을 나타냅니다. 'HEAD' 를 이동하면, 사용하는 브랜치가 변경됩니다.

- '~(틸드)'와 숫자를 'HEAD' 뒤에 붙여 몇 세대 앞의 커밋을 가리킬 수 있습니다. '^(캐럿)'은, 브랜치 병합에서 원본이 여럿 있는 경우 몇 번째 원본인지를 지정할 수 있습니다.

#### statsh

- stash 란, 파일의 변경 내용을 일시적으로 기록해두는 영역입니다. stash 를 사용하여 작업 트리와 인덱스 내에서 아직 커밋하지 않은 변경을 일시적으로 저장해 둘 수 있습니다. 이 stash 에 저장된 변경 내용은 나중에 다시 불러와 원래의 브랜치나 다른 브랜치에 커밋할 수 있습니다.

- 기본적으로 수정한 파일들이 잇는상태에서 브랜치를 변경하면 그 수정한 파일들을 들고 브랜치를 옮기는게 깃의 룰. 당연히 수정된 것들이 반영이 안되고 바뀔것 같았지만 그렇지 않다.

- A, B 두 브랜치가 같은 파일을 수정하고 서로의 브랜치로 체크아웃을 하게 되면, 체크아웃이 안된다. 왜냐하면 서로 수정한 파일이 같기때문에 충돌의 위험성이 있기 때문. 이를 위해서 보통 커밋하지 않은 수정된 파일이 있을 때에는 스태쉬 공간에 그 수정 파일을 넣어두고 체크아웃을 할 수 있다.

```
statsh 실습해보기.
```


#### fast-forward merge, merge commit

master 브랜치에서 bugfix 브랜치를 땃고 이상태에서 master 브랜치가 더이상 커밋내역이 없다면. bugfix 브랜치를 빠르게 병합할 수 있다. 이를 fast-forward merge 라고 부른다. 이것은 커밋이 따로 생성되지 않으며 bugfix 브랜치의 방향을 master 브랜치가 그대로 따라간다.

이게 저번에 내가 머지를 했는데 머지 커밋이 따로 안나오고 다른 브랜치의 커밋 내역이 모두 들어왔던 이유가 바로 이거인듯 하다.

```
A -> B
     ㄴ X -> Y
```

병합 실행 시에 위처럼 'fast-forward merge' 가 가능한 경우라도, 'non fast-forward' 옵션을 지정하여 merge commit을 만들어낼 수 있다.

만약 bugfix 브랜치를 만들고 난 이후에 master 브랜치에 추가적인 commit 내역이 존재한다면 fast-forward merge 가 아닌 merge commit 이 실행된다 

```
merge commit 과 fast forward merge 의 차이가 내가 생각하는 것이 맞는지 테스트해보기
```


#### rebase 

```
A -> B -> C -> D
     ㄴ -> X -> Y
```

위와 동일하게 master, bugfix 브랜치 두개가 존재한다고 할 때, rebase 방법은 X, Y 커밋 내역을 master 브랜치의 마지막 커밋내역인 D 뒤로 일자로 붙여서 통합하는 방법이다.

```
A -> B -> C -> D -> X -> Y
```

C, D 의 작업과 X, Y 의 작업이 충돌이 발생할 수 있으며 이는 수동 수정해주어야 한다.

하나 주의할 점은 rebase 를 했다고 해서 master 브랜치의 커밋내역은 X, Y 가 들어와있지 않다. 이를 위해서 fast-forward 머지를 한번 더 호출해주어야 한다.

일반적인 사용방법

토픽(피처) 브랜치에 통합(마스터) 브랜치의 최신 코드를 적용할 경우에는 rebase 를 사용,
통합(마스터) 브랜치에 토픽(피처) 브랜치를 불러올 경우에는 우선 rebase 를 한 후 merge

리베이스할때는 보통 피쳐 브랜치에서 통합 브랜치를 리베이스!


#### git flow

- master
'배포 가능한 형상' 만을 관리하는 브랜치. 커밋할 때에는 태그를 사용하여 배포번호를 기록.

- develop
위에서 언급한 통합 브랜치의 역할. 이 브랜치를 기반으로 개발을 진행한다.

- feature
위에서 언급한 토픽 브랜치의 역할. develop 브랜치로 부터 분기되어서 작업을 진행한다.
이 브랜치의 작업들은 보통 공유될 필요가 없기 때문에, 원격으로는 관리하지 않는다.

- release
배포 이전에 배포 테스트를 위해서 사용하는 브랜치이다. 모든 기능이 정상적으로 동작하는지 확인하기 위해 사용.
릴리즈 브랜치에서 수정될 내용을 수정하고 커밋을 하고 난 뒤 확인이 모두 끝나게 되면 이 브랜치는 develop 브랜치와
master 두 브랜치에 머지가 되어야 한다.

- hotfix
이미 master 를 통해 배포된 형상에 문제가 있을 때에, 빠르게 수정하기 위한 브랜치.


 체크아웃(checkout)이란, 내가 사용할 브랜치를 지정하는 것을 의미합니다.


- 원격 저장소의 브랜치와, 로컬 저장소의 브랜치도 결국 두 브랜치 라고 생각하면 될듯.
그렇게 추상화가 되어있음. 단지 물리적으로 멀리 존재할 뿐. 테크닉은 동일함.


### 태그는 두 종류가 존재챼

일반 태그(Lightweight tag)
이름만 붙일 수 있어요

주석 태그(Annotated tag)
이름을 붙일 수 있어요
태그에 대한 설명도 포함할 수 있어요
서명도 넣을 수 있어요
이 태그를 만든 사람의 이름, 이메일과 태그를 만든 날짜 정보도 포함시킬 수 있어요

보통 '릴리스 브랜치(Release branch)'에서는 주석 태그를 사용하여 설명이나 서명을 넣은 보다 상세한 정보를 포함하는 태그를 사용하고, 로컬에서 일시적으로 사용하는 '토픽 브랜치(Topic branch)'에서는 이름만 만들어 붙이는 태그를 사용합니다.

태그를 활용해서 checkout, reset, pull, push 등이 가능하다.

```
git tag 활용해서 checkout, reset, pull, push, 생성, 삭제 해보기
```



###

'--amend' 옵션을 지정하여 커밋을 수행하면, 같은 브랜치 상에서 이전에 커밋했던 내용에 새로운 내용을 추가하거나 설명을 수정할 수 있습니다.

reset 브랜치를 통합브랜치에서 사용하기는 어려운게. 만약 내가 작업한게 가장 마지막 커밋 내역이 아니라면.  reset 을 썼을 경우 나의 다음에 적용된 커밋 내역들도 삭제가 된다.

그래서 보통 나의 커밋 작업만을 지우기 위해서 revert 커밋을 한다.
revert 커밋은 내가 작업한 내용의 반대 작업을 하는 커밋을 새롭게 날리는 것.

그래서 커밋 이력도 지운 커밋이라고 새롭게 추가된다. (즉 이력도 남게됨.)


reset 명령어를 이용하면 더 이상 필요 없어진 커밋들을 버릴 수 있습니다. 명령어 실행 시 어떤 모드로 실행할 지 지정하여 'HEAD' 위치와 인덱스, 작업 트리 내용을 함께 되돌릴지 여부를 선택할 수 있습니다.


### cherry-pick

cherry-pick 을 이용하면 다른 브랜치에서 지정한 커밋을 복사하여 현재 브랜치로 가져올 수 있습니다.

이럴 때 사용해 보세요 :

특정 브랜치에 잘못 추가한 커밋을 올바른 브랜치로 옮기려고 할 때
다른 브랜치의 커밋을 현재 브랜치에도 추가하고 싶을 때

```
cherry-pick 한번 활용해서 다른 브랜치 내용을 가져와보자.
```



### squash

이번에는 병합(merge) 할 때 사용할 수 있는, 조금 특별한 옵션인 '--squash'를 소개합니다.

이 옵션을 지정하여 브랜치를 병합하면 해당 브랜치의 커밋 전체를 통합한 커밋이 추가됩니다.


이럴 때 사용해 보세요 :

토픽 브랜치 안의 커밋을 한꺼번에 모아서 통합 브랜치에 병합하고자 할 때